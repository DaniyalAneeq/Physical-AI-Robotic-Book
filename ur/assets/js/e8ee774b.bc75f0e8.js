"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[450],{1830:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module1/chapter2","title":"ROS 2 Nodes, Topics, and Messages","description":"Learning Objectives","source":"@site/docs/module1/chapter2.md","sourceDirName":"module1","slug":"/module1/chapter2","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter2","draft":false,"unlisted":false,"editUrl":"https://github.com/DaniyalAneeq/Physical-AI-Robotic-Book/tree/main/AIdd-book/docs/module1/chapter2.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"chapter2","title":"ROS 2 Nodes, Topics, and Messages","sidebar_position":2},"sidebar":"bookSidebar","previous":{"title":"Introduction to ROS 2","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter1"},"next":{"title":"ROS 2 Services and Actions: Request/Reply and Long-Running Tasks","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter3"}}');var r=n(4848),t=n(8453);const l={id:"chapter2",title:"ROS 2 Nodes, Topics, and Messages",sidebar_position:2},a=void 0,o={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Deep Theoretical Explanation",id:"deep-theoretical-explanation",level:2},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:3},{value:"Practical Tasks",id:"practical-tasks",level:2},{value:"1. Create a New ROS 2 Package",id:"1-create-a-new-ros-2-package",level:3},{value:"2. Create a Custom Message",id:"2-create-a-custom-message",level:3},{value:"3. Build the Package",id:"3-build-the-package",level:3},{value:"4. Implement the Talker and Listener Nodes",id:"4-implement-the-talker-and-listener-nodes",level:3},{value:"5. Run and Verify",id:"5-run-and-verify",level:3},{value:"Diagrams",id:"diagrams",level:2},{value:"Code Templates",id:"code-templates",level:2},{value:"Python <code>rclpy</code> Talker Node (Publisher)",id:"python-rclpy-talker-node-publisher",level:3},{value:"Python <code>rclpy</code> Listener Node (Subscriber)",id:"python-rclpy-listener-node-subscriber",level:3}];function d(e){const s={code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Deepen understanding of ROS 2 nodes and their lifecycle."}),"\n",(0,r.jsx)(s.li,{children:"Master the publish/subscribe communication pattern using topics and messages."}),"\n",(0,r.jsx)(s.li,{children:"Define custom message types for structured data communication."}),"\n",(0,r.jsx)(s.li,{children:"Create a complete ROS 2 package from scratch, including building and running it."}),"\n",(0,r.jsxs)(s.li,{children:["Implement simple ROS 2 publishers and subscribers in Python using ",(0,r.jsx)(s.code,{children:"rclpy"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Nodes"}),": The fundamental processing units in a ROS 2 system. Each node should have a single, well-defined purpose (e.g., controlling a wheel, processing camera images). A complex system is built by composing many simple nodes."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Topics"}),": The primary communication channel for publish/subscribe messaging. Topics are strongly typed; a topic can only transmit messages of a single, defined message type. This ensures type safety at the communication layer."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Messages"}),": Structured data containers defined in ",(0,r.jsx)(s.code,{children:".msg"})," files. They consist of a set of typed fields. ROS 2 provides a vast library of standard messages, but defining custom messages is essential for creating tailored applications."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Packages"}),": The primary unit of organization for ROS 2 code. A package contains everything related to a specific piece of functionality, including nodes, message definitions, launch files, and configuration files."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"rclpy"})}),": The Python client library for ROS 2. It provides the high-level functionality for creating nodes, publishers, subscribers, and other ROS 2 entities in Python."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"colcon"})}),": The standard build tool for ROS 2. It is used to build and install ROS 2 workspaces and packages."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"deep-theoretical-explanation",children:"Deep Theoretical Explanation"}),"\n",(0,r.jsx)(s.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,r.jsxs)(s.p,{children:["In ROS 2, nodes can exist in a more controlled state machine called the ",(0,r.jsx)(s.strong,{children:"Lifecycle"}),". This is particularly important for building robust, fault-tolerant systems. A lifecycle node has the following primary states:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Unconfigured"}),": The initial state. The node has been created but has not allocated any resources."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Configuring"}),": A transitional state where the node is allocating resources and setting up its internal state."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Inactive"}),": The node is configured but not currently active. It is not processing data or responding to requests."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Activating"}),": A transitional state where the node is preparing to become active."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Active"}),": The node is fully operational and performing its tasks."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Deactivating"}),": A transitional state where the node is stopping its active processes."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cleaning up"}),": A transitional state where the node is releasing resources."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Finalized"}),": The terminal state."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This state machine allows a system supervisor to manage the startup, shutdown, and recovery of nodes in a predictable way."}),"\n",(0,r.jsx)(s.h3,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,r.jsxs)(s.p,{children:["ROS 2's use of DDS enables fine-grained control over the ",(0,r.jsx)(s.strong,{children:"Quality of Service (QoS)"})," of communication. QoS policies determine how messages are handled by the middleware. Some of the most important QoS settings include:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"History"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"KEEP_LAST"}),": Store up to a specified number of recent messages."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"KEEP_ALL"}),": Store all messages, up to the resource limits of the system."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Depth"}),": Used with ",(0,r.jsx)(s.code,{children:"KEEP_LAST"})," to specify how many messages to keep."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Reliability"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"RELIABLE"}),": Guarantees delivery. Important for critical data like commands."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"BEST_EFFORT"}),": Faster, but may drop messages. Suitable for high-frequency sensor data where a single missed message is not critical."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Durability"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"VOLATILE"}),": Messages are not persisted."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"TRANSIENT_LOCAL"}),": Publishers store a configurable number of recent messages, which are delivered to any late-joining subscribers. This is extremely useful for topics that publish configuration or status information."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"practical-tasks",children:"Practical Tasks"}),"\n",(0,r.jsx)(s.h3,{id:"1-create-a-new-ros-2-package",children:"1. Create a New ROS 2 Package"}),"\n",(0,r.jsxs)(s.p,{children:["Let's create a package named ",(0,r.jsx)(s.code,{children:"my_first_package"})," to house our custom message and nodes."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python my_first_package --dependencies rclpy std_msgs\n"})}),"\n",(0,r.jsx)(s.h3,{id:"2-create-a-custom-message",children:"2. Create a Custom Message"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Create a ",(0,r.jsx)(s.code,{children:"msg"})," directory inside your new package:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/my_first_package/my_first_package/msg\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Create a new file named ",(0,r.jsx)(s.code,{children:"MyCustomMessage.msg"})," in that directory with the following content:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"# ~/ros2_ws/src/my_first_package/my_first_package/msg/MyCustomMessage.msg\nstd_msgs/Header header\nstring data\nfloat32 temperature\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Modify ",(0,r.jsx)(s.code,{children:"~/ros2_ws/src/my_first_package/package.xml"})," to add the dependencies needed to build the message:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-xml",children:"<build_depend>rosidl_default_generators</build_depend>\n<exec_depend>rosidl_default_runtime</exec_depend>\n<member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Modify ",(0,r.jsx)(s.code,{children:"~/ros2_ws/src/my_first_package/setup.py"})," to ensure the ",(0,r.jsx)(s.code,{children:"msg"})," directory is found by ",(0,r.jsx)(s.code,{children:"colcon"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"3-build-the-package",children:"3. Build the Package"}),"\n",(0,r.jsx)(s.p,{children:"Navigate to the root of your workspace and build:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n",(0,r.jsx)(s.h3,{id:"4-implement-the-talker-and-listener-nodes",children:"4. Implement the Talker and Listener Nodes"}),"\n",(0,r.jsxs)(s.p,{children:["Place the Python code for ",(0,r.jsx)(s.code,{children:"my_talker.py"})," and ",(0,r.jsx)(s.code,{children:"my_listener.py"}),' (from the "Code Templates" section below) into the ',(0,r.jsx)(s.code,{children:"~/ros2_ws/src/my_first_package/my_first_package/"})," directory. Remember to update the code to import and use your new ",(0,r.jsx)(s.code,{children:"MyCustomMessage"})," type."]}),"\n",(0,r.jsxs)(s.p,{children:["Modify ",(0,r.jsx)(s.code,{children:"setup.py"})," to create entry points for your nodes, so ",(0,r.jsx)(s.code,{children:"ros2 run"})," can find them."]}),"\n",(0,r.jsx)(s.h3,{id:"5-run-and-verify",children:"5. Run and Verify"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Build the workspace again:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Run the listener:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 run my_first_package my_listener\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["In a new terminal, run the talker:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 run my_first_package my_talker\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Verify communication with ",(0,r.jsx)(s.code,{children:"ros2 topic echo"}),":","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ros2 topic echo /my_topic\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"diagrams",children:"Diagrams"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Publisher-Subscriber Communication Flow"}),': This diagram will show two nodes, a "Talker" and a "Listener". An arrow will originate from the Talker, point to a box representing the topic (',(0,r.jsx)(s.code,{children:"/my_topic"}),"), and another arrow will point from the topic to the Listener. This visually represents the unidirectional flow of data."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"ROS 2 Package Structure"}),": A tree diagram showing the standard layout of a ROS 2 Python package, including ",(0,r.jsx)(s.code,{children:"package.xml"}),", ",(0,r.jsx)(s.code,{children:"setup.py"}),", the node source files, and the ",(0,r.jsx)(s.code,{children:"msg"})," directory."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"code-templates",children:"Code Templates"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.em,{children:["Note: You will need to modify these to use ",(0,r.jsx)(s.code,{children:"my_first_package.msg.MyCustomMessage"})," instead of ",(0,r.jsx)(s.code,{children:"std_msgs.msg.String"})," and populate the custom fields."]})}),"\n",(0,r.jsxs)(s.h3,{id:"python-rclpy-talker-node-publisher",children:["Python ",(0,r.jsx)(s.code,{children:"rclpy"})," Talker Node (Publisher)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# examples/module1/chapter2-nodes-topics/my_talker.py\n# (This code would be placed in ~/ros2_ws/src/my_first_package/my_first_package/my_talker.py)\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String # Replace with your custom message\n\nclass MyTalker(Node):\n    def __init__(self):\n        super().__init__('my_talker')\n        self.publisher_ = self.create_publisher(String, 'my_topic', 10)\n        timer_period = 1.0\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.counter = 0\n        self.get_logger().info('MyTalker node started.')\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello from MyTalker! Count: {self.counter}'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.counter += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyTalker()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(s.h3,{id:"python-rclpy-listener-node-subscriber",children:["Python ",(0,r.jsx)(s.code,{children:"rclpy"})," Listener Node (Subscriber)"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:"# examples/module1/chapter2-nodes-topics/my_listener.py\n# (This code would be placed in ~/ros2_ws/src/my_first_package/my_first_package/my_listener.py)\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String # Replace with your custom message\n\nclass MyListener(Node):\n    def __init__(self):\n        super().__init__('my_listener')\n        self.subscription = self.create_subscription(\n            String,\n            'my_topic',\n            self.listener_callback,\n            10)\n        self.get_logger().info('MyListener node started.')\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyListener()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var i=n(6540);const r={},t=i.createContext(r);function l(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);