"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[822],{2097:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"module1/chapter4","title":"Parameters and TF2: Configuration and Coordinate Frames","description":"Learning Objectives","source":"@site/docs/module1/chapter4.md","sourceDirName":"module1","slug":"/module1/chapter4","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter4","draft":false,"unlisted":false,"editUrl":"https://github.com/DaniyalAneeq/Physical-AI-Robotic-Book/tree/main/AIdd-book/docs/module1/chapter4.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"chapter4","title":"Parameters and TF2: Configuration and Coordinate Frames","sidebar_position":4},"sidebar":"bookSidebar","previous":{"title":"ROS 2 Services and Actions: Request/Reply and Long-Running Tasks","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter3"},"next":{"title":"Robot Description and Gazebo Simulation","permalink":"/Physical-AI-Robotic-Book/ur/docs/module1/chapter5"}}');var t=n(4848),s=n(8453);const i={id:"chapter4",title:"Parameters and TF2: Configuration and Coordinate Frames",sidebar_position:4},o=void 0,l={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Deep Theoretical Explanation",id:"deep-theoretical-explanation",level:2},{value:"How TF2 Works",id:"how-tf2-works",level:3},{value:"Practical Tasks",id:"practical-tasks",level:2},{value:"1. Using Parameters and YAML Files",id:"1-using-parameters-and-yaml-files",level:3},{value:"2. Implementing a Full TF2 System",id:"2-implementing-a-full-tf2-system",level:3},{value:"Diagrams",id:"diagrams",level:2},{value:"Code Templates",id:"code-templates",level:2},{value:"Python <code>rclpy</code> Parameter Usage Example",id:"python-rclpy-parameter-usage-example",level:3},{value:"Python <code>rclpy</code> Static TF2 Broadcaster Example",id:"python-rclpy-static-tf2-broadcaster-example",level:3}];function d(e){const r={code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Understand how to use ROS 2 parameters for dynamic, run-time configuration of nodes."}),"\n",(0,t.jsx)(r.li,{children:"Learn to load parameters from YAML files for organized and reusable configurations."}),"\n",(0,t.jsx)(r.li,{children:"Master the TF2 (Transformations) library for managing and transforming data between different coordinate frames."}),"\n",(0,t.jsx)(r.li,{children:"Implement TF2 broadcasters and listeners in Python to build a complete robot coordinate system."}),"\n",(0,t.jsx)(r.li,{children:"Visualize coordinate frames and their relationships using RViz2."}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Parameters"}),": Key-value pairs associated with a node that can be modified at runtime without recompiling code. They are essential for tuning and configuring robot behavior. ROS 2 supports various parameter types, including strings, integers, floats, booleans, and arrays."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Parameter Server"}),": Each ROS 2 node has its own internal parameter server. The ",(0,t.jsx)(r.code,{children:"ros2 param"})," command-line tool communicates with these individual servers to get, set, list, or dump parameters."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"TF2"}),": The official transformation library in ROS 2. It manages the complex web of coordinate frames (e.g., ",(0,t.jsx)(r.code,{children:"world"}),", ",(0,t.jsx)(r.code,{children:"base_link"}),", ",(0,t.jsx)(r.code,{children:"camera_link"}),", ",(0,t.jsx)(r.code,{children:"gripper_link"}),') in a robotic system, allowing you to ask questions like, "What is the position of the apple (in the ',(0,t.jsx)(r.code,{children:"camera_link"})," frame) relative to the robot's hand (in the ",(0,t.jsx)(r.code,{children:"gripper_link"}),' frame)?"']}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"tf2_ros"})}),": The ROS 2 package that provides the necessary tools to work with TF2, including the transform listener and broadcaster."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Static Transform"}),": A transform between two coordinate frames that never changes (e.g., the mounting position of a camera on a robot's chassis). These are published once and are assumed to be valid indefinitely."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Dynamic Transform"}),": A transform that changes over time (e.g., the relationship between a moving robot's base and a fixed world frame). These must be published continuously."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Transform Tree"}),": The entire collection of coordinate frames and the transforms that connect them, forming a tree-like structure."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"deep-theoretical-explanation",children:"Deep Theoretical Explanation"}),"\n",(0,t.jsx)(r.h3,{id:"how-tf2-works",children:"How TF2 Works"}),"\n",(0,t.jsxs)(r.p,{children:["TF2 operates on a simple but powerful principle: it builds a ",(0,t.jsx)(r.strong,{children:"tree"})," of coordinate frames. Each transform defines a parent-child relationship. For example, publishing a transform from ",(0,t.jsx)(r.code,{children:"world"})," (parent) to ",(0,t.jsx)(r.code,{children:"base_link"})," (child) tells TF2 how to get from the world frame to the robot's base frame."]}),"\n",(0,t.jsx)(r.p,{children:"The core components of TF2 are:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"tf2_ros.Buffer"})}),": The buffer stores all the transforms it receives from broadcasters for a configurable amount of time. It is the central database of coordinate frame information."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"tf2_ros.TransformListener"})}),": The listener subscribes to the ",(0,t.jsx)(r.code,{children:"/tf"})," and ",(0,t.jsx)(r.code,{children:"/tf_static"})," topics, collects all broadcasted transforms, and populates the buffer."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsxs)(r.strong,{children:[(0,t.jsx)(r.code,{children:"tf2_ros.TransformBroadcaster"})," / ",(0,t.jsx)(r.code,{children:"StaticTransformBroadcaster"})]}),": These are used to publish dynamic and static transforms, respectively."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["When you request a transform between two arbitrary frames (e.g., ",(0,t.jsx)(r.code,{children:"camera_link"})," to ",(0,t.jsx)(r.code,{children:"gripper_link"}),"), the TF2 buffer traverses the transform tree to find a path between them. It then concatenates the transforms along this path to compute the final transformation. This allows for a completely decentralized system where different nodes can be responsible for publishing different parts of the transform tree."]}),"\n",(0,t.jsx)(r.h2,{id:"practical-tasks",children:"Practical Tasks"}),"\n",(0,t.jsx)(r.h3,{id:"1-using-parameters-and-yaml-files",children:"1. Using Parameters and YAML Files"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Create a Parameter YAML file"}),": Create a file named ",(0,t.jsx)(r.code,{children:"my_params.yaml"})," in a ",(0,t.jsx)(r.code,{children:"config"})," directory within your package (",(0,t.jsx)(r.code,{children:"my_first_package/config/my_params.yaml"}),"):","\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'parameter_node:\n  ros__parameters:\n    my_parameter: "world"\n    frequency: 2.0\n'})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Create a Launch File"}),": Create a launch file (",(0,t.jsx)(r.code,{children:"my_first_package/launch/params_launch.py"}),") to start the node and load the parameters:","\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"from ament_index_python.packages import get_package_share_directory\nfrom launch import LaunchDescription\nfrom launch_ros.actions import Node\nimport os\n\ndef generate_launch_description():\n    config = os.path.join(\n        get_package_share_directory('my_first_package'),\n        'config',\n        'my_params.yaml'\n        )\n\n    return LaunchDescription([\n        Node(\n            package='my_first_package',\n            executable='parameter_node', # Assumes entry point is named 'parameter_node'\n            name='parameter_node',\n            parameters=[config]\n        )\n    ])\n"})}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Run the Launch File"}),":","\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 launch my_first_package params_launch.py\n"})}),"\n","You will see the node start with the values from your YAML file."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"2-implementing-a-full-tf2-system",children:"2. Implementing a Full TF2 System"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Implement a Dynamic TF2 Broadcaster"}),": Create a Python node that publishes a continuously changing transform, for example, a robot base moving in a circle."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Implement a Static TF2 Broadcaster"}),": Create a node that publishes the fixed transform from the robot's ",(0,t.jsx)(r.code,{children:"base_link"})," to a ",(0,t.jsx)(r.code,{children:"camera_link"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Implement a TF2 Listener"}),": Create a node that listens to the transform tree and calculates the transform from the ",(0,t.jsx)(r.code,{children:"camera_link"})," to a dynamic frame."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Visualize with RViz2"}),": Use RViz2 to add a TF display and visualize the entire coordinate frame tree in real-time."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"diagrams",children:"Diagrams"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Parameter Server Interaction"}),": A diagram showing a launch file loading a YAML file. The parameters are passed to a newly created node, which then populates its internal Parameter Server. The ",(0,t.jsx)(r.code,{children:"ros2 param"})," tool is shown interacting with the node's server to inspect and change values at runtime."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"TF2 Tree Example"}),": A diagram illustrating a typical robot transform tree. It would show ",(0,t.jsx)(r.code,{children:"world"})," as the root, with a child ",(0,t.jsx)(r.code,{children:"odom"}),". ",(0,t.jsx)(r.code,{children:"odom"})," would be the parent of ",(0,t.jsx)(r.code,{children:"base_link"}),". ",(0,t.jsx)(r.code,{children:"base_link"})," would have multiple children, such as ",(0,t.jsx)(r.code,{children:"camera_link"}),", ",(0,t.jsx)(r.code,{children:"lidar_link"}),", and ",(0,t.jsx)(r.code,{children:"left_wheel_link"}),", visually representing the robot's physical structure."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"code-templates",children:"Code Templates"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.em,{children:["(These templates provide a starting point. You would integrate them into your ",(0,t.jsx)(r.code,{children:"my_first_package"}),".)"]})}),"\n",(0,t.jsxs)(r.h3,{id:"python-rclpy-parameter-usage-example",children:["Python ",(0,t.jsx)(r.code,{children:"rclpy"})," Parameter Usage Example"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# examples/module1/chapter4-params-tf2/parameter_node.py\nimport rclpy\nfrom rclpy.node import Node\n\nclass ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n        # Declare parameters with default values\n        self.declare_parameter('my_parameter', 'default_value')\n        self.declare_parameter('frequency', 1.0)\n        self.get_logger().info('ParameterNode started.')\n\n        # Create a timer that uses one of the parameters\n        frequency = self.get_parameter('frequency').get_parameter_value().double_value\n        self.timer = self.create_timer(1.0 / frequency, self.timer_callback)\n\n    def timer_callback(self):\n        my_parameter = self.get_parameter('my_parameter').get_parameter_value().string_value\n        self.get_logger().info(f'My parameter is: {my_parameter}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ParameterNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsxs)(r.h3,{id:"python-rclpy-static-tf2-broadcaster-example",children:["Python ",(0,t.jsx)(r.code,{children:"rclpy"})," Static TF2 Broadcaster Example"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# examples/module1/chapter4-params-tf2/static_tf2_broadcaster.py\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros.static_transform_broadcaster import StaticTransformBroadcaster\nimport tf_transformations\n\nclass StaticFramePublisher(Node):\n    def __init__(self):\n        super().__init__('static_tf2_broadcaster')\n        self._tf_publisher = StaticTransformBroadcaster(self)\n        self.make_transforms()\n\n    def make_transforms(self):\n        static_transformStamped = TransformStamped()\n        static_transformStamped.header.stamp = self.get_clock().now().to_msg()\n        static_transformStamped.header.frame_id = 'base_link'\n        static_transformStamped.child_frame_id = 'camera_link'\n        static_transformStamped.transform.translation.x = 0.1\n        static_transformStamped.transform.translation.y = 0.0\n        static_transformStamped.transform.translation.z = 0.2\n        quat = tf_transformations.quaternion_from_euler(0, 0, 0)\n        static_transformStamped.transform.rotation.x = quat[0]\n        static_transformStamped.transform.rotation.y = quat[1]\n        static_transformStamped.transform.rotation.z = quat[2]\n        static_transformStamped.transform.rotation.w = quat[3]\n\n        self._tf_publisher.sendTransform(static_transformStamped)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = StaticFramePublisher()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})})]})}function m(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>o});var a=n(6540);const t={},s=a.createContext(t);function i(e){const r=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(s.Provider,{value:r},e.children)}}}]);